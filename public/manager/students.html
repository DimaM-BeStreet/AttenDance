<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#7c3aed">
    <title>ניהול תלמידים - AttenDance</title>
</head>
<body>
    <!-- Navigation will be injected here -->
    <div id="navbar-container"></div>

    <main class="page-main">
        <!-- Header -->
        <div class="page-header selectionModeHidden">
            <div class="header-content">
                <h1 class="page-title">תלמידים</h1>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary" id="importStudentsBtn">
                    <span class="btn-icon">📥</span>
                    יבוא תלמידים
                </button>
                <button class="btn btn-primary" id="addStudentBtn">
                    <span class="btn-icon">➕</span>
                    תלמיד חדש
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container selectionModeHidden">
            <button class="tab tab-active" data-tab="permanent">
                תלמידים קבועים
            </button>
            <button class="tab" data-tab="temp">
                תלמידים זמניים
            </button>
        </div>

        <!-- Bulk Actions Toolbar (hidden by default) -->
        <div id="bulkActionsToolbar" class="bulk-actions-toolbar" style="display: none;">
            <button class="btn-back" id="backBtn" title="חזרה">
                <span class="back-arrow">→</span>
            </button>
            <div class="bulk-actions-content">
                <div class="bulk-actions-info">
                    <span id="selectedCount">0</span> נבחרו
                </div>
                <div class="bulk-actions-buttons">
                    <button class="btn btn-primary btn-compact" id="bulkEnrollClassBtn">
                        <span class="btn-text">רשום<br>לשיעור</span>
                    </button>
                    <button class="btn btn-primary btn-compact" id="bulkEnrollCourseBtn">
                        <span class="btn-text">רשום<br>לקורס</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="filters-section">
            <div class="search-box">
                <input 
                    type="search" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="חיפוש תלמיד..."
                    autocomplete="off"
                >
                <span class="search-icon">🔍</span>
            </div>
            <div class="filter-chips" style="display: flex; gap: 8px; margin-bottom: 20px;">
                <button class="chip chip-active" data-filter="all">
                    הכל
                </button>
                <button class="chip" data-filter="active">
                    פעילים
                </button>
                <button class="chip" data-filter="inactive">
                    לא פעילים
                </button>
            </div>
        </div>

        <!-- Students Table -->
        <div id="studentsTableContainer" class="table-container">
            <!-- Table will be rendered here -->
            <div class="loading-state">טוען תלמידים...</div>
        </div>
    </main>

    <!-- Bulk Enroll to Class Modal -->
    <div id="bulkEnrollClassModal" class="modal-content" style="display: none;">
        <div class="modal-header">
            <h3>רישום תלמידים לשיעור</h3>
            <button class="modal-close" data-modal-close>&times;</button>
        </div>
        <div class="modal-body">
            <p>רושמים <strong><span id="bulkClassStudentCount">0</span></strong> תלמידים</p>
            <div style="background: #e3f2fd; padding: 10px; border-radius: 6px; font-size: 13px; color: #1976d2; margin-bottom: 16px;">
                ℹ️ מציג עד 20 שיעורים קרובים. השתמש בחיפוש ובסינון למציאת שיעור ספציפי.
            </div>
            
            <!-- Filters Section -->
            <div class="filter-section">
                <div class="form-group">
                    <label for="bulkClassSearch">חיפוש שיעור</label>
                    <input type="text" id="bulkClassSearch" class="form-control" placeholder="חפש שיעור או מורה...">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <select id="bulkClassBranchFilter" class="form-control">
                            <option value="">כל הסניפים</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="date" id="bulkClassDateFilter" class="form-control">
                    </div>
                </div>
            </div>
            
            <!-- Class Instances List -->
            <div id="bulkClassInstancesList" class="bulk-instances-list" style="max-height: 300px; overflow-y: auto;">
                <div class="loading-state">טוען שיעורים...</div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-modal-close">ביטול</button>
        </div>
    </div>

    <!-- Bulk Enroll to Course Modal -->
    <div id="bulkEnrollCourseModal" class="modal-content" style="display: none;">
        <div class="modal-header">
            <h3>רישום תלמידים לקורסים</h3>
            <button class="modal-close" data-modal-close>&times;</button>
        </div>
        <div class="modal-body">
            <p>רושמים <strong><span id="bulkCourseStudentCount">0</span></strong> תלמידים</p>
            <div class="selection-info" id="courseSelectionInfo" style="display: none;">
                <span id="selectedCoursesCount">0</span> קורסים נבחרו
            </div>
            <div style="background: #e3f2fd; padding: 10px; border-radius: 6px; font-size: 13px; color: #1976d2; margin-bottom: 16px;">
                ℹ️ מציג עד 50 קורסים פעילים. השתמש בחיפוש ובסינון למציאת קורס ספציפי.
            </div>
            
            <!-- Filters Section -->
            <div class="filter-section">
                <label>חיפוש קורס</label>
                <div class="form-row">
                    <div class="form-group">
                        <input type="text" id="bulkCourseSearch" class="form-control" placeholder="חפש קורס...">
                    </div>
                    <div class="form-group">
                        <select id="bulkCourseBranchFilter" class="form-control">
                            <option value="">כל הסניפים</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Courses List -->
            <div id="bulkCoursesList" class="bulk-courses-list" style="max-height: 300px; overflow-y: auto;">
                <div class="loading-state">טוען קורסים...</div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-modal-close>ביטול</button>
            <button type="button" class="btn btn-primary" id="proceedWithCoursesBtn" style="display: none;">המשך לרישום</button>
        </div>
    </div>

    <!-- Add/Edit Student Modal -->
    <div id="studentModal" class="modal-content" style="display: none;">
        <div class="modal-header">
            <h3 id="modalTitle">תלמיד חדש</h3>
            <button class="modal-close" data-modal-close>&times;</button>
        </div>
        <div class="modal-body">
            <form id="studentForm" novalidate>
                <!-- Photo Upload -->
                <div class="form-group">
                    <label class="form-label">תמונה</label>
                    <div class="photo-upload-container">
                        <div class="photo-preview" id="photoPreview">
                            <div class="photo-placeholder">📷</div>
                        </div>
                        <input 
                            type="file" 
                            id="photoInput" 
                            accept="image/*" 
                            style="display: none;"
                        >
                        <div class="photo-actions">
                            <button type="button" class="btn btn-secondary btn-sm" id="uploadPhotoBtn">
                                בחר תמונה
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" id="removePhotoBtn" style="display: none;">
                                הסר תמונה
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Personal Info -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName" class="form-label required">שם פרטי</label>
                        <input 
                            type="text" 
                            id="firstName" 
                            name="firstName" 
                            class="form-input" 
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label for="lastName" class="form-label required">שם משפחה</label>
                        <input 
                            type="text" 
                            id="lastName" 
                            name="lastName" 
                            class="form-input" 
                            required
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">אימייל</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input"
                        dir="ltr"
                    >
                </div>

                <div class="form-group">
                    <label for="phone" class="form-label required">טלפון</label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        class="form-input" 
                        required
                        dir="ltr"
                        placeholder="05X-XXXXXXX"
                    >
                </div>

                <div class="form-group">
                    <label for="dateOfBirth" class="form-label">תאריך לידה</label>
                    <input 
                        type="text" 
                        id="dateOfBirth" 
                        name="dateOfBirth" 
                        class="form-input"
                        placeholder="dd/mm/yyyy"
                        pattern="\d{2}/\d{2}/\d{4}"
                    >
                </div>

                <!-- Parent Info -->
                <div class="form-section-title">פרטי הורה</div>
                
                <div class="form-group">
                    <label for="parentName" class="form-label">שם הורה</label>
                    <input 
                        type="text" 
                        id="parentName" 
                        name="parentName" 
                        class="form-input"
                    >
                </div>

                <div class="form-group">
                    <label for="parentPhone" class="form-label">טלפון הורה</label>
                    <input 
                        type="tel" 
                        id="parentPhone" 
                        name="parentPhone" 
                        class="form-input"
                        dir="ltr"
                        placeholder="05X-XXXXXXX"
                    >
                </div>

                <div class="form-group">
                    <label for="parentEmail" class="form-label">אימייל הורה</label>
                    <input 
                        type="email" 
                        id="parentEmail" 
                        name="parentEmail" 
                        class="form-input"
                        dir="ltr"
                    >
                </div>

                <!-- Additional Info -->
                <div class="form-group">
                    <label for="notes" class="form-label">הערות</label>
                    <textarea 
                        id="notes" 
                        name="notes" 
                        class="form-input" 
                        rows="3"
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input 
                            type="checkbox" 
                            id="status" 
                            name="status" 
                            checked
                        >
                        <span>סטטוס פעיל</span>
                    </label>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        <span class="btn-spinner" style="display: none;"></span>
                        שמור
                    </button>
                    <button type="button" class="btn btn-secondary" data-modal-close>
                        ביטול
                    </button>
                    <button type="button" class="btn btn-danger" id="deleteStudentBtn" style="display: none;">
                        מחק תלמיד
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-content" style="display: none;">
        <div class="modal-header">
            <h3>מחיקת תלמיד</h3>
            <button class="modal-close" data-modal-close>&times;</button>
        </div>
        <div class="modal-body">
            <p>האם אתה בטוח שברצונך למחוק את התלמיד <strong id="deleteStudentName"></strong>?</p>
            <p class="text-danger">פעולה זו תעביר את התלמיד לארכיון.</p>
            <div class="form-actions">
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    מחק
                </button>
                <button type="button" class="btn btn-secondary" data-modal-close>
                    ביטול
                </button>
            </div>
        </div>
    </div>

    <!-- Student Details Modal -->
    <div id="detailsModal" class="modal-content" style="display: none;">
        <div class="modal-header">
            <h3 id="detailsStudentName">פרטי תלמיד</h3>
            <button class="modal-close" data-modal-close>&times;</button>
        </div>
        <div class="modal-body">
            <div class="student-details-container">
                <div class="details-photo" id="detailsPhoto"></div>
                <div class="details-info" id="detailsInfo">
                    <!-- Details will be populated here -->
                </div>
                <div class="details-stats" id="detailsStats">
                    <!-- Statistics will be populated here -->
                </div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-primary" id="editFromDetailsBtn">
                    ✏️ עריכה
                </button>
                <button type="button" class="btn btn-secondary" id="viewEnrollmentsBtn">
                    📚 רישומים
                </button>
                <button type="button" class="btn btn-secondary" id="viewAttendanceBtn">
                    ✅ נוכחות
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="../js/manager/students.bundle.js"></script>
</body>
</html>
